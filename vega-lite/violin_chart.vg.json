{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Distribution of AQI of States (2005-2022)",
  "background": null,
  "data": {
    "url": "../data/api/aqi_kde_by_state.csv",
    "format": {
      "type": "csv",
      "parse": {
        "aqi": "number",
        "density": "number"
      }
    }
  },
  "transform": [
    {
      "filter": "datum.aqi <= 100"
    },
    {
      "lookup": "state",
      "from": {
        "data": {
          "url": "../data/api/mean_aqi_per_state.csv",
          "format": {
            "type": "csv",
            "parse": {
              "mean_aqi": "number"
            }
          }
        },
        "key": "state",
        "fields": ["mean_aqi", "region"]
      }
    }
  ],
  "facet": {
    "row": {
      "field": "state",
      "type": "nominal",
      "title": "State",
      "header": {
        "labelAngle": 0,
        "labelAlign": "left",
        "title": null
      },
      "sort": {
        "field": "mean_aqi",
        "op": "mean",
        "order": "descending"
      }
    }
  },
  "spec": {
    "width": 350,
    "height": 35,
    "layer": [
      {
        "mark": {
          "type": "area",
          "color": "orange"
        },
        "encoding": {
          "x": {
            "field": "aqi",
            "type": "quantitative",
            "title": "AQI",
            "scale": {
              "zero": false,
              "domain": [0, 100]
            }
          },
          "y": {
            "field": "density",
            "type": "quantitative",
            "title": "",
            "axis": {
              "labels": false,
              "ticks": false
            },
            "stack": "center"
          },
          "tooltip": [
            {
              "field": "aqi",
              "type": "quantitative",
              "title": "AQI"
            },
            {
              "field": "density",
              "type": "quantitative",
              "title": "Density"
            },
            {
              "field": "mean_aqi",
              "type": "quantitative",
              "title": "Average"
            }
          ]
        }
      },
      {
        "mark": {
          "type": "rule",
          "color": "black",
          "strokeWidth": 0.5
        },
        "encoding": {
          "x": {
            "field": "mean_aqi",
            "type": "quantitative"
          }
        }
      }
    ]
  }
}